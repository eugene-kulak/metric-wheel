env:
  global:
    - REPO_DIR="metric"
    - PACKAGE_DIR="metric/python"
    - BUILD_COMMIT=HEAD
    - PLAT=x86_64
    - BUILD_DEPENDS="auditwheel==3.1.0"
    - TEST_DEPENDS="pytest"
    - UNICODE_WIDTH=32
    - TWINE_REPOSITORY_URL="https://upload.pypi.org/legacy/"
    - secure: "MCbzfXbni6k+wI+AnJP4djw4sUFuyJuQ1Ht3gpjgV5k/f+vn/BbxfB3qSxAk+vj4ECd4k1vXMi4JxyNtUNWRJb60PQLC0ULxbWQT6/BmNT3tLB+dvUR5Udb8kyGbJO52jFxA9LIEWyTGsAWJDpica30eYi8Gj8Bb8eq60MrmBCokdDn916rYC+Hz5B7aTS8nsnY8wXJoQLV0yGBgRi3KHYNM8O3UorX0rh19MbGoHfiY6MyFhxvY0k2FQt2nTcb5lwDKQEP5vNBXkUV/plssIGFRxyoSIDiUr72BtPdEA1l4NFSQE3uXeiTi62hdOEAmSzoHmODymIXaFEBFCogN8hK/0VHXP+slxU7lgLwCeEyDkJQFzj34TIiOMIZTUguUa8qHO1t5pPLOot8CS+yMA04WrMqeGLhNIeekpjwYYOHLPHaJtZhWpcWdI53HEMmcX34R/GC93hgEpn0HtXkKTgTiusqTF6HP7E9crgSrK4yiQaDgHKm0222NUUtbDxTzKwolknW9moHF+GOKvHxLUO0jx0tbOD0oUZIrlV/QLDbNwkATlfL5nb05h6N5edCiVvLeYZjJrvtprVNx3Z5qr+d25NM+bqWxL9IkJ2Re8RhPPUYzDn9r11IXhjNyq5h4QYvwioCHcqb3KhRtn82+lWE1+FYUMV6g0oGkDA+uIdk="
    - MB_PYTHON_VERSION=3.7
language: generic
python: 3.7
dist: xenial
services: docker

jobs:
  include:
  # Linux builds
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8
  # OS X builds
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.6
        - VENV=venv
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.7
        - VENV=venv
    - os: osx
      env:
        - MB_PYTHON_VERSION=3.8
        - VENV=venv
  # Windows builds (see .appveyor.yml)

before_install:
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install
install:
  - clean_code $REPO_DIR $BUILD_COMMIT
  - build_wheel $PACKAGE_DIR $PLAT
# TODO: install and test before publish
#script:
#  - install_run $PLAT
after_success:
  - source publish.sh
  - upload_to_pypi $PYPI_SERVER
